% works with CSV
close
clear all
clc

[amp, phase, pos, ntrans, npoints]=read_raw_ani('array_info/dual_8x8_proto2/pos_xyz_move.ani');
out_dir='../data/pos_xyz_move_proto2/'

init_value = [ 0x000, 0x018, 0x270, 0x2B0, 0x030, 0x000, 0x020, 0x028,
               0x018, 0x008, 0x048, 0x028, 0x058, 0x010, 0x008, 0x028,
               0x010, 0x2A0, 0x038, 0x038, 0x028, 0x4c8, 0x014, 0x028,
               0x018, 0x4c8, 0x010, 0x000, 0x000, 0x028, 0x010, 0x018,
               0x4b8, 0x020, 0x018, 0x028, 0x4b8, 0x010, 0x4d8, 0x038,
               0x008, 0x038, 0x018, 0x4c8, 0x038, 0x028, 0x020, 0x280,
               0x290, 0x040, 0x040, 0x010, 0x010, 0x008, 0x038, 0x030,
               0x000, 0x000, 0x018, 0x018, 0x000, 0x000, 0x040, 0x010,

               0x030, 0x000, 0x028, 0x000, 0x248, 0x038, 0x020, 0x040,
               0x028, 0x2b0, 0x018, 0x00C, 0x2A0, 0x278, 0x288, 0x040,
               0x050, 0x000, 0x000, 0x030, 0x4d0, 0x020, 0x008, 0x010,
               0x008, 0x01c, 0x4c8, 0x4b0, 0x4b0, 0x4b0, 0x008, 0x000,
               0x000, 0x014, 0x018, 0x4b0, 0x4bc, 0x008, 0x4b0, 0x4d8,
               0x000, 0x4d8, 0x4c4, 0x4b0, 0x4b0, 0x4d0, 0x4c8, 0x488,
               0x4a8, 0x4d8, 0x4c8, 0x01c, 0x008, 0x02c, 0x010, 0x4d8,
               0x4b0, 0x048, 0x05c, 0x4b8, 0x4ac, 0x000, 0x000, 0x000 ];

init_value=init_value';

steps=length(phase(:, 1))

for ixx=1:steps
  out_file=[out_dir, 'file_', num2str(ixx, '%03d'), '.txt'];
  printf("Preparing file: %s\n", out_file);
  fo=fopen(out_file, "w");

  for jxx=1:ntrans
    fprintf(fo, "%02d", conv_to_ph(phase(ixx,jxx), init_value(jxx)));
    if(jxx < ntrans)
      fprintf(fo, " ");
    end
    if(mod(jxx, 8) == 0)
      fprintf(fo, "\n");
    end
  end
  fclose(fo);
end
