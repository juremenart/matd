% works with CSV
close
clear all
clc

file_list=[ 'array_info/dual_8x8_proto2/float_center_p1.csv' ];  % to sim_data_1
out_dir='../data/float_center_proto2_p1/'

%file_list=[ 'array_info/single_8x8/just_float.csv',
%            'array_info/single_8x8/move_up_1.csv',
%            'array_info/single_8x8/move_up_2.csv',
%            'array_info/single_8x8/move_up_3.csv',
%            'array_info/single_8x8/move_up_4.csv',
%            'array_info/single_8x8/move_up_5.csv',
%            'array_info/single_8x8/move_down_1.csv',
%            'array_info/single_8x8/move_down_2.csv',
%            'array_info/single_8x8/move_down_3.csv',
%            'array_info/single_8x8/move_down_4.csv' ];
%out_dir='../data/sim_data_2/'

% PROTO2: First board
% init_value =[
%              0, 0, 0, 0, 625, 0, 0, 0,
%              0, 625, 0, 0, 625, 625, 625, 0,
%              0, 0, 0, 0, 0, 0, 0, 0,
%              0, 0, 0, 0, 0, 0, 0, 0,
%              0, 0, 0, 0, 0, 0, 0, 0,
%              0, 0, 0, 0, 0, 0, 0, 0,
%              0, 0, 0, 0, 0, 0, 0, 0,
%              0, 0, 0, 0, 0, 625, 0, 0 ];

% PROTO2: Second board
%init_value =[
%             0, 0, 625, 625, 0, 0, 0, 0,
%             0, 0, 0, 0, 0, 0, 0, 0,
%             0, 625, 0, 0, 0, 0, 0, 0,
%             0, 0, 0, 0, 0, 0, 0, 0,
%             0, 0, 0, 0, 0, 0, 0, 0,
%             0, 0, 0, 0, 0, 0, 0, 625,
%             625, 0, 0, 0, 0, 0, 0, 0,
%             0, 0, 0, 0, 0, 0, 0, 0 ];
%

% PROTO2: Second board, phase equalized
% init_value = [0x000, 0x028, 0x260, 0x2B0, 0x028, 0x020, 0x038, 0x028,
%               0x010, 0x4c0, 0x030, 0x028, 0x060, 0x008, 0x020, 0x038,
%               0x020, 0x2A0, 0x038, 0x038, 0x030, 0x008, 0x018, 0x030,
%               0x040, 0x010, 0x038, 0x008, 0x030, 0x060, 0x048, 0x058,
%               0x000, 0x038, 0x028, 0x038, 0x018, 0x048, 0x028, 0x050,
%               0x048, 0x060, 0x050, 0x4d8, 0x080, 0x064, 0x068, 0x2a8,
%               0x2c8, 0x068, 0x078, 0x000, 0x060, 0x070, 0x068, 0x060,
%               0x020, 0x034, 0x028, 0x048, 0x010, 0x4b8, 0x4a8, 0x000 ];

init_value = [ 0x000, 0x018, 0x270, 0x2B0, 0x030, 0x000, 0x020, 0x028,
               0x018, 0x008, 0x048, 0x028, 0x058, 0x010, 0x008, 0x028,
               0x010, 0x2A0, 0x038, 0x038, 0x028, 0x4c8, 0x014, 0x028,
               0x018, 0x4c8, 0x010, 0x000, 0x000, 0x028, 0x010, 0x018,
               0x4b8, 0x020, 0x018, 0x028, 0x4b8, 0x010, 0x4d8, 0x038,
               0x008, 0x038, 0x018, 0x4c8, 0x038, 0x028, 0x020, 0x280,
               0x290, 0x040, 0x040, 0x010, 0x010, 0x008, 0x038, 0x030,
               0x000, 0x000, 0x018, 0x018, 0x000, 0x000, 0x040, 0x010,

               0x030, 0x000, 0x028, 0x000, 0x248, 0x038, 0x020, 0x040,
               0x028, 0x2b0, 0x018, 0x00C, 0x2A0, 0x278, 0x288, 0x040,
               0x050, 0x000, 0x000, 0x030, 0x4d0, 0x020, 0x008, 0x010,
               0x008, 0x01c, 0x4c8, 0x4b0, 0x4b0, 0x4b0, 0x008, 0x000,
               0x000, 0x014, 0x018, 0x4b0, 0x4bc, 0x008, 0x4b0, 0x4d8,
               0x000, 0x4d8, 0x4c4, 0x4b0, 0x4b0, 0x4d0, 0x4c8, 0x488,
               0x4a8, 0x4d8, 0x4c8, 0x01c, 0x008, 0x02c, 0x010, 0x4d8,
               0x4b0, 0x048, 0x05c, 0x4b8, 0x4ac, 0x000, 0x000, 0x000 ];

init_value=init_value';

for ixx=1:length(file_list(:, 1))
  [amp, phase, ntrans]=read_raw_csv(file_list(ixx, :));

  out_file=[out_dir, 'file_', num2str(ixx, '%03d'), '.txt'];
  printf("Preparing file: %s\n", out_file);
  fo=fopen(out_file, "w");

  for jxx=1:ntrans
    fprintf(fo, "%02d", conv_to_ph(phase(ixx,jxx), init_value(jxx)));
    if(jxx < ntrans)
      fprintf(fo, " ");
    end
    if(mod(jxx, 8) == 0)
      fprintf(fo, "\n");
    end
  end
  fclose(fo);
end
